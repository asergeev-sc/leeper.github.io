<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>MTurk Worker Soft Block</title>
		<link rel="stylesheet" href="style.css" type="text/css" />
	</head>
	<body>
		<div style="font-family:sans-serif;margin-left:10%;margin-right:10%;">
			<p style="font-weight:bold;margin-left:15%;margin-right:15%;font-size:2em;">Display Survey Link Conditional on Previous Completion</p>
			
			<script language="javascript">
			// RETRIEVE URL
			var fullurl=new String();
			// THIS IS THE LINE TO CAPTURE THE ACTUAL URL:
			// var fullurl=document.location.href;
			
			// THIS LINE IS JUST HERE FOR SANDBOX TO TEST THAT THE CODE IS WORKING
			var fullurl=new String("https://s3.amazonaws.com/mturk_bulk/hits/46029244/xIpb71zULpXQALR7MKF2DA.html?assignmentId=2PB51Y7QEOZFH9JGPVKMUFXTFYWGDA&hitId=2OMJ79KQW6186NX9AI3DA5XC8D2JL4&workerId=A1RO9EXAMPLE65&turkSubmitTo=https%3A%2F%2Fwww.mturk.com");
			
			// FIND workerId IN THE URL PARAMETERS
			var bits = new Array();
			bits = fullurl.split("&");
			var finalbit = new Array();
			finalbit = bits[2].split("=");
			
			// WHAT TO DO IF THE WORKER IS PREVIEWING THE HIT
			if(finalbit[1]=="ASSIGNMENT_ID_NOT_AVAILABLE")
				{
				document.write("<p style='font-weight:bold;text-align:center;'>Link will become available once you accept the HIT.</p>");
				}
			// CHECK workerId AGAINST THE LIST OF INELIGIBLE WORKERS
			else if (finalbit[1]=="A23JA6ICO4BPQ5" ||
				finalbit[1]=="A3DTS2LSSZGK5W" ||
				finalbit[1]=="A3JMPI8HZATQ4Q" ||
				finalbit[1]=="A2GKX2DKD177CL" ||
				finalbit[1]=="AAOU4JUTKQH5Q" ||
				finalbit[1]=="A3BFHFBYDCCIGV" ||
				finalbit[1]=="A2ASW4THRF5BW5" ||
				finalbit[1]=="A219VCQZADQ45W" ||
				finalbit[1]=="A9IPAROGKKDY9" ||
				finalbit[1]=="AFIIFNK4FM7MZ"
				)
			  { 
				document.write("<b>You have already completed this survey and are therefore ineligible to complete it again. Sorry.</b>");
			  }
			// IF NOT IN THE ABOVE LIST AND NOT PREVIEWING, DISPLAY LINK
			// COULD BE RECONFIGURED TO DO SOMETHING ELSE, BUT THIS IS A SIMPLE EXAMPLE
			else {
			  var surveylink = new String("https://www.text.com/survey");
			  document.write("<a href=\"" + surveylink + "\" target=\"_blank\">Click here to complete the survey</a><br />");
			  }
			</script>
			</p>
		</div>
	</body>
</html>